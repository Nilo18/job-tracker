<app-header [loggedIn]="showLoggedInHeader" [userData]="data"></app-header>
<div class="cont">
    <div class="dashboard d-flex flex-column gap-4 mt-5">
        <!-- <img [src]="data.picture" alt="Profile image"> -->
        <h1>Hello {{data.name}}!</h1>
        <!-- <p ngbTooltip="User email">{{data.email}}</p> -->
         <section class="dashboard-stats">
            <div class="dashboard-stats-card card d-flex justify-content-center align-items-center">
                <div class="card-body d-flex flex-column justify-content-center align-items-start gap-4">
                    <h5 class="card-title">Total Applications</h5>
                    <h1 class="card-subtitle mb-2 text-body-secondary">25</h1>
                </div>
            </div>
            <div class="dashboard-stats-card card d-flex justify-content-center align-items-center">
                <div class="card-body d-flex flex-column justify-content-center align-items-start gap-4">
                    <h5 class="card-title">Accepted Applications</h5>
                    <h1 class="card-subtitle mb-2 text-body-secondary">18</h1>
                </div>
            </div>
            <div class="dashboard-stats-card card d-flex justify-content-center align-items-center">
                <div class="card-body d-flex flex-column justify-content-center align-items-start gap-4">
                    <h5 class="card-title">Rejected Applications</h5>
                    <h1 class="card-subtitle mb-2 text-body-secondary">5</h1>
                </div>
            </div>
            <div class="dashboard-stats-card card d-flex justify-content-center align-items-center">
                <div class="card-body d-flex flex-column justify-content-center align-items-start gap-4">
                    <h5 class="card-title">Pending Applications</h5>
                    <h1 class="card-subtitle mb-2 text-body-secondary">2</h1>
                </div>
            </div>
         </section>
         <section class="dashboard-applications">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Company name</th>
                        <th scope="col">Date sent</th>
                        <th scope="col">Response</th>
                        <th scope="col">Operations</th>
                    </tr>
                </thead>
                <tbody>
                    @for (job of jobs$ | async; track job._id; let i = $index) {
                        <tr class="dashboard-apptable-tr">
                            <th scope="row">{{i + 1}}</th>
                            <td>
                                <div class="dashboard-apptable-td">
                                    @if (!showNameInputs[i]) {
                                        {{ job.company_name }}
                                    }  @else {
                                        <input type="text" class="form-control" [formControl]="companyNameControl" 
                                        (keydown.enter)="editJobApp(job._id, 'company_name', companyNameControl.value)">
                                    }  
                                        
                                    <mat-icon (click)="toggleNameEditInput(job?._id)">edit</mat-icon>
                                </div>
                            </td>
                            <td>
                                <div class="dashboard-apptable-td">
                                    @if (!showDateInputs[i]) {
                                        {{job.date_sent}}
                                    }  @else {
                                        <input type="date" class="form-control" [formControl]="dateControl"
                                        (change)="editJobApp(job._id, 'date_sent', dateControl.value)">
                                    }  

                                    <mat-icon (click)="toggleDateEditInput(job?._id)">edit</mat-icon>       
                                </div>
                            </td>
                            <td>
                                <div class="dashboard-apptable-td">
                                    @if (!showStatusInputs[i]) {
                                        {{job.status}}
                                    }  @else {
                                        <select class="form-select" [formControl]="statusControl"
                                            (change)="editJobApp(job._id, 'status', statusControl.value)">
                                            <option value="Pending">Pending</option>
                                            <option value="Rejected">Rejected</option>
                                            <option value="Accepted">Accepted</option>
                                        </select>
                                    }  

                                    <mat-icon (click)="toggleStatusEditInput(job?._id)">edit</mat-icon>       
                                </div>  
                            </td>
                            <td (click)="deleteJobApp(job._id)">
                                <button class="custom-table-btn">
                                    Remove
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="dashboard-addapplication-btn-container">
                <button type="button" (click)="showAddModal($event)">+</button>
            </div>
         </section>
    </div>
</div>
